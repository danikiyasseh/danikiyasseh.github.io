<html>
  
<head>
  <script src="https://cdn.jsdelivr.net/npm/onnxjs/dist/onnx.min.js"></script>
  <script src="./ndarray-browser-min.js"></script>
  <script src="./imagenet.js"></script>
  <script src="./image-loader.js"></script>
  <script src="https://unpkg.com/wavesurfer.js"></script>
  <script src="https://unpkg.com/wavesurfer.js/dist/plugin/wavesurfer.spectrogram.min.js"></script>
  <script src="https://unpkg.com/wavesurfer.js/dist/plugin/wavesurfer.microphone.min.js""></script>
  <script src="./index.js"></script>
  <link rel="stylesheet" href="./audio.css" />
  <script>
    const imageHeight = 1000;
    const imageWidth = 64;
  </script>
</head>
  
<body>
  <h1>Resnet50 Example</h1>
  <img id="imageSource" src="./gray_cat.jpg"/>
  <div>
    <input type="button" value="Run" onclick="runExample()">
  </div>
  <div id="predictions">
  </div>
  
  <h2>Waveform</h2>
  <div id="waveform">
  </div>
  
  <h2>Spectrogram</h2>
  <div id="wave-spectrogram"></div>

  <h2>Record</h2>
  <div id="wave-recording"></div>
  
  <script type="text/javascript">
    
     var wavesurfer = WaveSurfer.create({
          container: '#waveform',
          waveColor: '#F2EDD4',
          progressColor: '#46B54D',
          plugins: [
          WaveSurfer.spectrogram.create({
              container: "#wave-spectrogram",
              fftSamples: 1024,
              labels: true
          }),
          WaveSurfer.microphone.create({
            container: "#wave-recording"
          })
          ]
      });

      wavesurfer.load('./song.mp3');
                         
//     wavesurfer.on('ready', function () {
//       var spectrogram = Object.create(WaveSurfer.Spectrogram);
//       spectrogram.init({
//         wavesurfer: wavesurfer,
//         container: '#wave-spectrogram',
//         fftSamples: 512,
//         labels: true
//       });
//     });    
    
//   var wavesurfer = WaveSurfer.create({
//         container: '#waveform'
//     });

//     wavesurfer.load('./song.mp3');
//     wavesurfer.on('ready', function () {
//         wavesurfer.play();
//     });
    
  </script>
  
  <script>
                                        
  navigator.mediaDevices.getUserMedia({ audio: true })
  .then(stream => {
    const mediaRecorder = new MediaRecorder(stream);
    mediaRecorder.start();

    const audioChunks = [];
    mediaRecorder.addEventListener("dataavailable", event => {
      audioChunks.push(event.data);
    });

    mediaRecorder.addEventListener("stop", () => {
      const audioBlob = new Blob(audioChunks);
      const audioUrl = URL.createObjectURL(audioBlob);
      const audio = new Audio(audioUrl);
      audio.play();
    });

    setTimeout(() => {
      mediaRecorder.stop();
    }, 3000);
  });
                                        
  </script>
                                         
  <button class="btn btn-primary" onclick="wavesurfer.playPause()">
    <i class="glyphicon glyphicon-play"></i>
    Play/Pause
  </button>
  
</body>
</html>
